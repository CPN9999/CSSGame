<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSS Position Game</title>
    <style>
      body {
        font-family: sans-serif;
        background: #222;
        color: #fff;
        text-align: center;
        padding-top: 20px;
      }

      #viewport {
        position: relative;
        width: 500px;
        height: 300px;
        background: #111;
        border: 2px solid #555;
        margin: 20px auto;
        overflow: hidden;
        padding: 10px;
      }

      .rect {
        width: 50px;
        height: 50px;
      }

      #orange {
        background: orange;
        position: absolute;
      }

      #blue {
        background: dodgerblue;
        position: static;
      }

      #inputArea {
        width: 500px;
        margin: 10px auto;
      }

      #cssInput {
        width: 100%;
        height: 80px;
        font-family: monospace;
        font-size: 14px;
        border: none;
        border-radius: 6px;
        padding: 10px;
      }

      #goBtn {
        margin-top: 8px;
        padding: 8px 16px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 6px;
        background: limegreen;
        color: white;
      }

      #message {
        margin-top: 15px;
        font-size: 20px;
      }

      #keyword {
        font-size: 18px;
        margin-top: 10px;
        color: #ffcc00;
      }

      .dummy-text {
        color: #aaa;
        font-size: 14px;
        text-align: left;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <h2>L√†m cho h√¨nh xanh che h·∫øt h√¨nh cam b·∫±ng CSS!</h2>
    <div id="keyword">Keyword b·∫Øt bu·ªôc: <strong>static</strong></div>

    <div id="viewport">
      <div id="orange" class="rect"></div>
      <div id="blue" class="rect"></div>
      <p class="dummy-text">
        ƒê√¢y l√† m·ªôt ƒëo·∫°n vƒÉn b·∫£n ƒë·ªÉ b·∫°n th·∫•y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa c√°c ki·ªÉu
        position.
      </p>
      <p class="dummy-text">
        Khi d√πng <code>relative</code>, h√¨nh xanh s·∫Ω di chuy·ªÉn m√† v·ªã tr√≠ c≈© v·∫´n
        gi·ªØ nguy√™n. Khi d√πng <code>absolute</code>, n√≥ s·∫Ω ch·ªìng l√™n vƒÉn b·∫£n. Khi
        d√πng <code>fixed</code>, n√≥ s·∫Ω c·ªë ƒë·ªãnh theo to√†n m√†n h√¨nh.
      </p>
      <p class="dummy-text">Th·ª≠ nghi·ªám ƒë·ªÉ c·∫£m nh·∫≠n s·ª± kh√°c bi·ªát nh√©!</p>
    </div>

    <div id="inputArea">
      <textarea
        id="cssInput"
        placeholder="Type your CSS here...&#10;e.g. position: absolute; top: 50px; left: 50px; width: 100px; height: 100px;"
      ></textarea>
      <br />
      <div style="margin-left: auto; color: #aaa; font-size: 13px">
        Tip: press Ctrl/‚åò + Enter to apply
      </div>
      <button id="goBtn">Go</button>
    </div>

    <div id="message"></div>

    <script>
      const viewport = document.getElementById("viewport");
      const orange = document.getElementById("orange");
      const blue = document.getElementById("blue");
      const input = document.getElementById("cssInput");
      const message = document.getElementById("message");
      const keywordBox = document.getElementById("keyword");
      const goBtn = document.getElementById("goBtn");

      const keywords = ["absolute", "relative", "fixed"];
      let currentKeyword = "static";
      let blueBaseTop = 0;
      let blueBaseLeft = 0;

      function getRandomInt(min, max) {
        return Math.round(Math.random() * (max - min) + min);
      }

      function randomizeOrange() {
        const maxW = 200,
          maxH = 150;
        const w = getRandomInt(50, maxW);
        const h = getRandomInt(50, maxH);
        const left = getRandomInt(0, viewport.clientWidth - w);
        const top = getRandomInt(0, viewport.clientHeight - h);
        Object.assign(orange.style, {
          width: w + "px",
          height: h + "px",
          left: left + "px",
          top: top + "px",
        });

        // Reset l·∫°i h√¨nh xanh
        Object.assign(blue.style, {
          position: "static",
          width: "50px",
          height: "50px",
          left: "",
          top: "",
        });
        message.textContent = "";
        currentKeyword = keywords[Math.floor(Math.random() * keywords.length)];
        keywordBox.innerHTML = `Keyword b·∫Øt bu·ªôc: <strong>${currentKeyword}</strong>`;

        // Ghi l·∫°i v·ªã tr√≠ ban ƒë·∫ßu c·ªßa blue trong viewport
        const rect = blue.getBoundingClientRect();
        const viewportRect = viewport.getBoundingClientRect();
        blueBaseLeft = rect.left - viewportRect.left;
        blueBaseTop = rect.top - viewportRect.top;
      }

      function checkOverlap() {
        const oRect = orange.getBoundingClientRect();
        const bRect = blue.getBoundingClientRect();
        if (
          Math.abs(bRect.left - oRect.left) < 1 &&
          Math.abs(bRect.top - oRect.top) < 1 &&
          Math.abs(bRect.right - oRect.right) < 1 &&
          Math.abs(bRect.bottom - oRect.bottom) < 1
        ) {
          message.textContent = "üéâ Good job!";
          setTimeout(randomizeOrange, 1500);
        }
      }

      goBtn.addEventListener("click", () => {
        const cssText = input.value.trim();
        try {
          const tempStyle = {};
          cssText.split(";").forEach((rule) => {
            if (!rule.trim()) return;
            const [prop, val] = rule.split(":");
            if (prop && val) tempStyle[prop.trim()] = val.trim();
          });

          if (!tempStyle.position || tempStyle.position !== currentKeyword) {
            message.textContent = `‚ö†Ô∏è B·∫°n ph·∫£i d√πng position: ${currentKeyword}!`;
            return;
          }

          // Reset style
          blue.removeAttribute("style");
          blue.className = "rect";

          // N·∫øu l√† relative ‚Üí h√†nh x·ª≠ nh∆∞ absolute nh∆∞ng v·∫´n cho pass
          if (tempStyle.position === "relative") {
            blue.style.position = "relative";
            for (const [prop, val] of Object.entries(tempStyle)) {
              if (prop !== "position") blue.style[prop] = val;
            }
            const top = parseFloat(tempStyle.top) || 0;
            const left = parseFloat(tempStyle.left) || 0;
            //blue.style.top = blueBaseTop + top + "px";
            //blue.style.left = blueBaseLeft + left + "px";
          } else if (tempStyle.position === "absolute") {
            blue.style.position = "absolute";
            for (const [prop, val] of Object.entries(tempStyle)) {
              if (prop !== "position") blue.style[prop] = val;
            }
          } else if (tempStyle.position === "fixed") {
            // "fixed" v·∫´n b·ªã gi·ªõi h·∫°n trong viewport, kh√¥ng ra ngo√†i
            blue.style.position = "fixed";
            for (const [prop, val] of Object.entries(tempStyle)) {
              if (prop !== "position") blue.style[prop] = val;
            }
          }

          if (!viewport.contains(blue)) viewport.appendChild(blue);

          checkOverlap();
        } catch {
          message.textContent = "Sai c√∫ ph√°p CSS!";
        }
      });

      input.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
          e.preventDefault();
          goBtn.click();
        }
      });

      randomizeOrange();
    </script>
  </body>
</html>
